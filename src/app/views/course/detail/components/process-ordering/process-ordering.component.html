<div class="process-ordering-container" dir="rtl" lang="ar">
    <div class="challenge-header">
      <h2>ترتيب مراحل التمثيل الضوئي</h2>
      <div class="progress-indicator">
        <span class="progress-text">
          @if (!isVerifying && !isCompleted) {
            رتب الخطوات بالترتيب الصحيح
          } @else if (isVerifying && !isCompleted) {
            جاري التحقق من الترتيب...
          } @else if (isCompleted) {
            تم الانتهاء!
          }
        </span>
        <div class="progress-bar">
          <div class="progress-fill" [style.width.%]="getProgressPercentage()"></div>
        </div>
      </div>
    </div>
  
    <div class="challenge-instructions">
      <p>اسحب وأفلت خطوات عملية التمثيل الضوئي لترتيبها بالتسلسل الصحيح من البداية إلى النهاية.</p>
    </div>
  
    @if (!isCompleted) {
      <div class="ordering-area" cdkDropListGroup>
        <div class="steps-container">
          <h3>الخطوات</h3>
          
          <div class="steps-list" 
          cdkDropList
          (cdkDropListDropped)="onDrop($event)">
            @for (step of userOrderedSteps; track step.id) {
              <div class="step-card" 
                   cdkDrag
                   [class.correct-position]="isVerifying && step.isCorrectPosition"
                   [class.incorrect-position]="isVerifying && !step.isCorrectPosition">
                <div class="step-number">{{step.userPosition + 1}}</div>
                <div class="step-content">
                  <p class="step-text">{{step.text}}</p>
                  <!-- @if (step.image) {
                    <img [src]="step.image" [alt]="step.text" class="step-image">
                  } -->
                </div>
                <div class="drag-handle" cdkDragHandle>
                  <i class="fa fa-bars"></i>
                </div>
              </div>
            }
          </div>
        </div>
      </div>
  
      <div class="action-buttons">
        <button class="submit-btn" (click)="verifyOrder()" [disabled]="isVerifying">
          تحقق من الترتيب
        </button>
        @if (attempts > 0) {
          <button class="reset-btn" (click)="resetOrder()">
            <i class="fa fa-redo"></i> إعادة ترتيب
          </button>
        }
      </div>
  
      @if (isVerifying) {
        <div class="order-feedback">
          <div class="feedback-message" [class.correct]="allCorrect" [class.incorrect]="!allCorrect">
            <i class="fa" [class.fa-check-circle]="allCorrect" [class.fa-times-circle]="!allCorrect"></i>
            <p>
              @if (allCorrect) {
                ممتاز! لقد رتبت جميع الخطوات بشكل صحيح.
              } @else {
                هناك بعض الخطوات في موقع غير صحيح. حاول مرة أخرى.
              }
            </p>
          </div>
          <div class="feedback-actions">
            @if (allCorrect) {
              <button class="continue-btn" (click)="completeChallenge()">
                متابعة <i class="fa fa-arrow-right"></i>
              </button>
            } @else {
              <button class="try-again-btn" (click)="tryAgain()">
                حاول مرة أخرى
              </button>
            }
          </div>
        </div>
      }
    } @else {
      <div class="challenge-results">
        <div class="results-card">
          <div class="results-header">
            <i class="fa fa-trophy"></i>
            <h3>اكتمل التحدي!</h3>
          </div>
          
          <div class="score-display">
            <div class="score-circle">
              <svg viewBox="0 0 36 36">
                <path class="circle-bg" d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831"/>
                <path class="circle-progress" 
                      [attr.stroke-dasharray]="(score / maxScore) * 100 + ', 100'" 
                      d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831"/>
                <text x="18" y="20.35" class="percentage">{{score}}/{{maxScore}}</text>
              </svg>
            </div>
            <div class="score-text">
              <p>لقد أكملت التحدي في <strong>{{attempts}}</strong> محاولات.</p>
              <p class="score-message">{{getScoreMessage()}}</p>
            </div>
          </div>
  
          <div class="results-actions">
            <button class="retry-btn" (click)="retryChallenge()">
              <i class="fa fa-redo"></i> إعادة المحاولة
            </button>
            <button class="complete-btn" (click)="finishChallenge()">
              <i class="fa fa-check"></i> إنهاء التحدي
            </button>
          </div>
        </div>
      </div>
    }
  </div>










  