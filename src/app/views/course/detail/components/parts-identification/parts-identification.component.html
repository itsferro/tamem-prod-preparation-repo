<!-- parts-identification.component.html -->
<div class="visual-identification-challenge" dir="rtl" lang="ar">
    <div class="challenge-header">
      <h2>التعرف على أجزاء النبات</h2>
      <div class="challenge-meta">
        <div class="score">
          النتيجة: <span>{{currentScore}}/{{maxScore}}</span>
        </div>
        <div class="attempts">
          المحاولات المتبقية: <span>{{attemptsRemaining}}</span>
        </div>
      </div>
    </div>
    
    <div class="challenge-instructions">
      <p>حدد أجزاء النبات المشاركة في عملية التمثيل الضوئي بالنقر على الاسم ثم النقر على موقعه في الصورة.</p>
    </div>
    
    <div class="challenge-content">
      <div class="plant-parts-container">
        <div class="plant-parts-list">
          <div class="parts-label">أجزاء النبات:</div>
          @for (part of plantParts; track part.id) {
            <div 
              class="plant-part-item" 
              [class.selected]="selectedPart?.id === part.id"
              [class.correctly-placed]="part.isCorrectlyPlaced"
              (click)="selectPart(part)"
              [class.disabled]="part.isCorrectlyPlaced">
              <div class="part-name">{{part.name}}</div>
            </div>
          }
        </div>
        
        <div class="plant-image-container">
          <img 
            [src]="plantImage" 
            alt="صورة نبات للتمثيل الضوئي" 
            (click)="placePartOnImage($event)"
            class="interactive-plant-image">
            
          <!-- Markers for parts that have been correctly placed -->
          @for (part of plantParts; track part.id) {
            @if (part.isCorrectlyPlaced) {
              <div 
                class="part-marker"
                [style.left.%]="part.correctPosition.x"
                [style.top.%]="part.correctPosition.y">
                <div class="marker-label">{{part.name}}</div>
              </div>
            }
          }
        </div>
        
        <div class="plant-part-info">
          @if (selectedPart) {
            <div class="part-details">
              <h3>{{selectedPart.name}}</h3>
              <p>{{selectedPart.description}}</p>
              <div class="placement-instruction">انقر على الصورة لتحديد موقع هذا الجزء</div>
            </div>
          } @else {
            <div class="info-placeholder">
              <p>اختر جزءاً من القائمة للحصول على معلومات عنه</p>
            </div>
          }
        </div>
      </div>
      
      @if (feedback) {
        <div class="feedback-area">
          <div class="feedback-message">{{feedback}}</div>
        </div>
      }
    </div>
    
    <div class="challenge-footer">
      @if (isCompleted) {
        <button 
          class="continue-btn"
          (click)="challengeCompleted.emit(4)">
          متابعة
        </button>
      }
      
      @if (attemptsRemaining <= 0 && !isCompleted) {
        <button 
          class="reset-btn"
          (click)="resetChallenge()">
          إعادة المحاولة
        </button>
      }
    </div>
  </div>
  