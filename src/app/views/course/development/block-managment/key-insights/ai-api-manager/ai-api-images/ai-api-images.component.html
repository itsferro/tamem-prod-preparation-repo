<div class="ai-images-analyzer">
    <!-- Header -->
    <div class="header">
      <h2>üñºÔ∏è AI Image Analysis Lab</h2>
      <p>Upload multiple images and analyze them with AI</p>
    </div>
  
    <!-- Main Content -->
    <div class="content-container">
      
      <!-- Left Panel: Image Upload & Settings -->
      <div class="upload-panel">
        
        <!-- Image Upload Area -->
        <div class="upload-section">
          <h3>üìÅ Upload Images</h3>
          
          <!-- Drag & Drop Area -->
          <div 
            class="upload-area"
            [class.drag-over]="isDragOver"
            (dragover)="onDragOver($event)"
            (dragleave)="onDragLeave($event)"
            (drop)="onDrop($event)">
            
            <div class="upload-content">
              <div class="upload-icon">üì∏</div>
              <p class="upload-text">Drag & drop images here</p>
              <p class="upload-subtext">or click to browse</p>
              <input 
                type="file" 
                #fileInput
                multiple 
                accept="image/*" 
                (change)="onFileSelect($event)"
                style="display: none;">
              <button 
                (click)="fileInput.click()" 
                class="btn btn-primary">
                Choose Images
              </button>
            </div>
            
            <div class="upload-info">
              <small>
                Max {{ maxImages }} images ‚Ä¢ Max 20MB each ‚Ä¢ JPG, PNG, GIF, WebP
              </small>
            </div>
          </div>
  
          <!-- Selected Images Grid -->
          <div class="images-grid" *ngIf="selectedImages.length > 0">
            <h4>Selected Images ({{ selectedImages.length }}/{{ maxImages }})</h4>
            
            <div class="images-container">
              <div *ngFor="let image of selectedImages" class="image-card">
                <div class="image-preview">
                  <img [src]="image.preview" [alt]="image.name">
                  <button 
                    (click)="removeImage(image.id)" 
                    class="remove-btn"
                    title="Remove image">
                    ‚úï
                  </button>
                </div>
                <div class="image-info">
                  <div class="image-name">{{ image.name }}</div>
                  <div class="image-size">{{ image.size }}</div>
                </div>
              </div>
            </div>
            
            <div class="images-actions">
              <button (click)="clearAllImages()" class="btn btn-secondary btn-sm">
                Clear All
              </button>
            </div>
          </div>
        </div>
  
        <!-- AI Settings -->
        <div class="settings-section">
          <h3>ü§ñ AI Settings</h3>
          
          <div class="setting-group">
            <label>Model:</label>
            <select [(ngModel)]="selectedModel" class="setting-select">
              <optgroup *ngFor="let provider of visionProviderKeys" 
                        [label]="provider">
                <option *ngFor="let model of groupedVisionModels[provider]" 
                        [value]="model.value">
                  {{ model.label }}
                </option>
              </optgroup>
            </select>
          </div>
          
          <div class="setting-group">
            <label>Creativity: {{ temperature }}</label>
            <input 
              type="range" 
              [(ngModel)]="temperature" 
              min="0" 
              max="1" 
              step="0.1" 
              class="setting-range">
            <small>{{ temperature < 0.3 ? 'Focused' : temperature < 0.7 ? 'Balanced' : 'Creative' }}</small>
          </div>
          
          <div class="setting-group">
            <label>Max Response Length:</label>
            <select [(ngModel)]="maxTokens" class="setting-select">
              <option value="500">Short (500)</option>
              <option value="1000">Medium (1000)</option>
              <option value="2000">Long (2000)</option>
              <option value="4000">Very Long (4000)</option>
            </select>
          </div>
        </div>
  
        <!-- Prompt Templates -->
        <div class="templates-section">
          <h3>üí° Quick Prompts</h3>
          <div class="template-buttons">
            <button 
              *ngFor="let template of promptTemplates"
              (click)="loadPromptTemplate(template)"
              class="template-btn">
              {{ template.name }}
            </button>
          </div>
        </div>
  
      </div>
  
      <!-- Right Panel: Prompt & Response -->
      <div class="analysis-panel">
        
        <!-- Prompt Section -->
        <div class="prompt-section">
          <h3>‚úçÔ∏è Your Prompt</h3>
          <textarea 
            [(ngModel)]="prompt"
            class="prompt-textarea"
            placeholder="Describe what you want the AI to do with these images...
  
  Examples:
  ‚Ä¢ Analyze these images and describe what you see
  ‚Ä¢ Compare these images and find differences
  ‚Ä¢ Extract all text from these images
  ‚Ä¢ Solve the math problems shown in these images
  ‚Ä¢ Identify objects and people in these images"
            rows="6">
          </textarea>
          
          <div class="prompt-actions">
            <button 
              (click)="sendToAi()" 
              [disabled]="isLoading || selectedImages.length === 0 || !prompt.trim()"
              class="btn btn-primary btn-large">
              <span *ngIf="isLoading" class="loading-spinner"></span>
              {{ isLoading ? 'Analyzing...' : 'üöÄ Analyze Images' }}
            </button>
          </div>
        </div>
  
        <!-- Response Section -->
        <div class="response-section">
          <div class="response-header">
            <h3>ü§ñ AI Response</h3>
            <div class="response-actions" *ngIf="response?.success">
              <button (click)="copyResponse()" class="btn btn-secondary btn-sm">
                Copy Response
              </button>
            </div>
          </div>
          
          <div class="response-container">
            <!-- Empty State -->
            <div *ngIf="!response && !isLoading" class="empty-state">
              <div class="empty-icon">ü§î</div>
              <p>Upload images and enter a prompt to get AI analysis</p>
            </div>
            
            <!-- Loading State -->
            <div *ngIf="isLoading" class="loading-state">
              <div class="loading-spinner large"></div>
              <p>AI is analyzing your images...</p>
              <small>This may take a moment for multiple images</small>
            </div>
            
            <!-- Success Response -->
            <div *ngIf="response?.success" class="response-content">
              <div class="response-meta">
                <span class="status-badge success">‚úì Success</span>
                <span class="timestamp">{{ response?.timestamp | date:'medium' }}</span>
              </div>
              
              <div class="response-text">
                {{ getResponseContent() }}
              </div>
              
              <!-- Raw Response Toggle -->
              <details class="raw-response">
                <summary>View Raw Response</summary>
                <pre class="json-display">{{ getFormattedResponse() }}</pre>
              </details>
            </div>
            
            <!-- Error Response -->
            <div *ngIf="response && !response.success" class="response-error">
              <div class="response-meta">
                <span class="status-badge error">‚úó Error</span>
                <span class="timestamp">{{ response.timestamp | date:'medium' }}</span>
              </div>
              <div class="error-message">
                <p>{{ response.error }}</p>
              </div>
            </div>
          </div>
        </div>
  
      </div>
    </div>
  </div>