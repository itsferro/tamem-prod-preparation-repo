<!-- Enhanced HTML for insights.component.html -->
<div class="insights-container" dir="rtl" style="padding:10px 0px 0px;">

    <div class="upload-actions">
        <button class="upload-btn secondary" (click)="loadInsightsData()">
            <i class="fas fa-refresh"></i>
            Load Insights
        </button>
        <button class="upload-btn primary" (click)="generateKeyInsights()" [disabled]="loading"
            [class.loading]="loading">
            <i class="fas fa-spinner fa-spin" *ngIf="loading"></i>
            <i class="fas fa-magic" *ngIf="!loading"></i>
            {{ loading ? 'Generating...' : 'Generate Insights' }}
        </button>
    </div>

    <div class="carousel-header">
        <h2>
            <i class="fas fa-lightbulb"></i>
            Key Insights
        </h2>
        <div class="carousel-controls">
            <button class="carousel-btn next" (click)="scrollCarousel('right')">
                <i class="fas fa-chevron-right"></i>
            </button>
            <button class="carousel-btn prev" (click)="scrollCarousel('left')">
                <i class="fas fa-chevron-left"></i>
            </button>
        </div>
    </div>

    <div class="carousel-container">
        <div class="insights-carousel" #insightsCarousel>
            @for (insight of currentInsights; track insight.id) {
            <div class="insight-card-horizontal" 
                 [class.selected]="selectedInsightId === insight.id"
                 [class.loading]="selectedInsightId === insight.id && isLoading"
                 [class]="'card-' + insight.type" 
                 (click)="selectInsight(insight.id)">

                <!-- Loading Overlay for Individual Card -->
                <div class="card-loading-overlay" *ngIf="selectedInsightId === insight.id && isLoading">
                    <div class="card-loading-spinner">
                        <div class="mini-rings">
                            <div class="mini-ring mini-ring-1"></div>
                            <div class="mini-ring mini-ring-2"></div>
                            <div class="mini-ring mini-ring-3"></div>
                        </div>
                    </div>
                    <div class="card-loading-text">Loading frames...</div>
                </div>

                <div class="card-header-horizontal">
                    <div class="type-badge-small" [class]="'badge-' + insight.insight_type">
                        <i [class]="getInsightTypeIcon(insight.insight_type)"></i>
                    </div>
                    <div class="card-menu-horizontal">
                        <button class="menu-btn-small" 
                                (click)="editInsight(insight.id); $event.stopPropagation()"
                                [disabled]="isLoading">
                            <i class="fas fa-edit"></i>
                        </button>

                        <button class="menu-btn-small" 
                                (click)="generateFramesForInsight(insight.id); $event.stopPropagation()"
                                [disabled]="isLoading">
                            <i class="fas fa-cog"></i>
                        </button>
                    </div>
                </div>

                <div class="card-content-horizontal">
                    <h3 class="insight-title-horizontal">{{ insight.learning_objective }}</h3>
                    <p class="insight-desc-horizontal">{{ insight.insight_text }}</p>

                    <div class="insight-meta-horizontal">
                        @if (insight.hasStoryboard) {
                        <div class="storyboard-indicator">
                            <i class="fas fa-film"></i>
                            <span>{{ insight.storyboardScenes }} scenes</span>
                        </div>
                        }
                    </div>
                </div>
            </div>
            }
        </div>
    </div>

    <!-- Empty State when no insight selected -->
    <section class="empty-state" *ngIf="!selectedInsightId && activeTab === 'insights' && !isLoading">
        <div class="empty-content">
            <div class="empty-icon">
                <i class="fas fa-mouse-pointer"></i>
            </div>
            <h3>Select an Insight</h3>
            <p>Choose a key insight from the carousel above to view its storyboard</p>
        </div>
    </section>

    <!-- Main Loading State for Frames -->
    <div class="frames-loading-state" *ngIf="isLoading && selectedInsightId">
        <div class="frames-loading-container">
            <div class="frames-loading-animation">
                <!-- Primary Loading Animation -->
                <div class="loading-brain-container">
                    <div class="loading-brain">
                        <div class="brain-core">
                            <div class="brain-pulse"></div>
                            <div class="brain-icon">
                                <i class="fas fa-brain"></i>
                            </div>
                        </div>
                        <div class="brain-waves">
                            <div class="wave wave-1"></div>
                            <div class="wave wave-2"></div>
                            <div class="wave wave-3"></div>
                            <div class="wave wave-4"></div>
                        </div>
                    </div>
                </div>

                <!-- Loading Progress Steps -->
                <div class="loading-steps">
                    <div class="step active">
                        <div class="step-icon">
                            <i class="fas fa-search"></i>
                        </div>
                        <div class="step-label">Analyzing Insight</div>
                    </div>
                    <div class="step-connector active"></div>
                    <div class="step" [class.active]="loadingStep >= 2">
                        <div class="step-icon">
                            <i class="fas fa-cogs"></i>
                        </div>
                        <div class="step-label">Processing Content</div>
                    </div>
                    <div class="step-connector" [class.active]="loadingStep >= 2"></div>
                    <div class="step" [class.active]="loadingStep >= 3">
                        <div class="step-icon">
                            <i class="fas fa-film"></i>
                        </div>
                        <div class="step-label">Building Frames</div>
                    </div>
                </div>

                <!-- Loading Progress Bar -->
                <div class="loading-progress-container">
                    <div class="loading-progress-bar">
                        <div class="progress-fill" [style.width.%]="loadingProgress"></div>
                        <div class="progress-shimmer"></div>
                    </div>
                    <div class="loading-percentage">{{ loadingProgress }}%</div>
                </div>
            </div>

            <div class="frames-loading-content">
                <h3>Loading Storyboard Frames</h3>
                <p>We're preparing the visual story for this insight...</p>
                <div class="loading-tips">
                    <div class="tip">
                        <i class="fas fa-lightbulb"></i>
                        <span>Each frame tells part of the story</span>
                    </div>
                    <div class="tip">
                        <i class="fas fa-palette"></i>
                        <span>Visual elements enhance learning</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Only render the frames component when data is actually available -->
    <div *ngIf="selectedInsightFrames && !isLoading">
        <block-managment-content-insight-frames [insightData]="selectedInsightFrames" />
    </div>

    <!-- Loading Overlay for Insights Generation -->
    <div class="loading-overlay" *ngIf="loading">
        <div class="loading-content">
            <div class="loading-spinner">
                <div class="spinner"></div>
            </div>
            <p>Generating insights...</p>
        </div>
    </div>

</div>