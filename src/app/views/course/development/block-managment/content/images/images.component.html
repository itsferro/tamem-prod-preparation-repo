<!-- <block-managment-ai-api-manager/>  -->

<!-- Key Insights - Compact Carousel Design -->
<div class="insights-container" dir="rtl" style="padding:10px 0px 0px;">

 

    <!-- Tabbed Content Section -->
    <section class="tabbed-content-section">

            <!-- Images  -->
                <div class="image-upload-section">
                    <div class="upload-header">
                        <!-- <h2>
                            <i class="fas fa-images"></i>
                            Block Images
                        </h2> -->
                        <div class="upload-actions">
                            <button class="upload-btn primary" (click)="triggerFileInput()">
                                <i class="fas fa-plus"></i>
                                Add Images
                            </button>
                            <button class="upload-btn secondary" [disabled]="uploadedImages.length === 0 || isSaving"
                                (click)="saveImages()">
                                <i class="fas fa-save"></i>
                                {{ isSaving ? 'Saving...' : 'Save Images' }}
                            </button>

    
                        </div>
                    </div>

                    <!-- File Input (Hidden) -->
                    <input type="file" #fileInput multiple accept="image/*" (change)="onFilesSelected($event)"
                        style="display: none;">

                    <!-- Upload Area -->
                    <!-- <div class="upload-area" [class.dragover]="isDragOver" (dragover)="onDragOver($event)"
                        (dragleave)="onDragLeave($event)" (drop)="onDrop($event)" (click)="triggerFileInput()">
                        <div class="upload-content">
                            <div class="upload-icon">
                                <i class="fas fa-cloud-upload-alt"></i>
                            </div>
                            <h3>Drop images here or click to upload</h3>
                            <p>Support multiple image files (JPG, PNG, GIF, WebP)</p>
                            <span class="upload-hint">Maximum 10 images, 5MB each</span>
                        </div>
                    </div> -->

                    <!-- New Uploads Section with Manual Reordering -->
                    <div class="image-section" *ngIf="uploadedImages.length > 0">
                        <div class="section-header">
                            <h4>
                                <i class="fas fa-clock"></i>
                                New Uploads (Not Saved Yet) - {{ uploadedImages.length }} image(s)
                            </h4>
                            <div class="section-actions" *ngIf="uploadedImages.length > 1">
                                <span class="reorder-hint">
                                    <i class="fas fa-arrows-alt-v"></i>
                                    Use arrows to reorder
                                </span>
                                <button class="reset-order-btn" (click)="resetImageOrder()"
                                    title="Reset to upload order">
                                    <i class="fas fa-undo"></i>
                                    Reset Order
                                </button>
                            </div>
                        </div>

                        <!-- Order info -->
                        <div class="order-info" *ngIf="uploadedImages.length > 1">
                            <p class="order-text">
                                <i class="fas fa-info-circle"></i>
                                Images will be saved in the order shown below. Use the arrow buttons to change their
                                order.
                            </p>
                        </div>

                        <div class="image-grid">
                            <div *ngFor="let image of uploadedImages; let i = index; trackBy: trackByImageId"
                                class="image-item pending-upload">

                                <!-- Order number indicator -->
                                <div class="order-indicator">
                                    <span class="order-number">{{ i + 1 }}</span>
                                </div>

                                <div class="image-preview">
                                    <img [src]="image.preview" [alt]="image.name">
                                    <div class="image-overlay">
                                        <button class="overlay-btn view"
                                            (click)="viewImage(image); $event.stopPropagation()">
                                            <i class="fas fa-eye"></i>
                                        </button>
                                        <button class="overlay-btn delete"
                                            (click)="removeImage(image.id); $event.stopPropagation()">
                                            <i class="fas fa-trash"></i>
                                        </button>
                                    </div>
                                    <!-- Pending indicator -->
                                    <div class="pending-indicator">
                                        <i class="fas fa-clock"></i>
                                    </div>
                                </div>

                                <div class="image-info">
                                    <span class="image-name">{{ image.name }}</span>
                                    <span class="image-size">{{ formatFileSize(image.size) }}</span>
                                    <span class="image-status pending">Position {{ i + 1 }}</span>
                                </div>

                                <!-- Manual sort buttons -->
                                <div class="sort-controls" *ngIf="uploadedImages.length > 1">
                                    <button class="sort-btn up" (click)="moveImageUp(i); $event.stopPropagation()"
                                        [disabled]="i === 0" title="Move up">
                                        <i class="fas fa-chevron-up"></i>
                                    </button>
                                    <button class="sort-btn down" (click)="moveImageDown(i); $event.stopPropagation()"
                                        [disabled]="i === uploadedImages.length - 1" title="Move down">
                                        <i class="fas fa-chevron-down"></i>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Saved Images Section -->
                    <div class="image-section" *ngIf="savedImages.length > 0 || isLoadingImages">
                        <h4>
                            <i class="fas fa-check-circle"></i>
                            Saved Images
                        </h4>

                        <!-- Loading state -->
                        <div class="loading-state" *ngIf="isLoadingImages">
                            <div class="loading-spinner">
                                <i class="fas fa-spinner fa-spin"></i>
                            </div>
                            <p>Loading saved images...</p>
                        </div>

                        <!-- Saved images grid -->
                        <div class="image-grid" *ngIf="!isLoadingImages && savedImages.length > 0">
                            @for (image of savedImages; track image.id) {
                            <div class="image-item saved-image">
                                <div class="image-preview">
                                    <img [src]="image.url" [alt]="image.name">
                                    <div class="image-overlay">
                                        <button class="overlay-btn view" (click)="viewImage(image)">
                                            <i class="fas fa-eye"></i>
                                        </button>
                                        <button class="overlay-btn delete" (click)="removeSavedImage(image.id)">
                                            <i class="fas fa-trash"></i>
                                        </button>
                                    </div>
                                    <!-- Saved indicator -->
                                    <div class="saved-indicator">
                                        <i class="fas fa-check-circle"></i>
                                    </div>
                                </div>
                                <div class="image-info">
                                    <span class="image-name">{{ image.name }}</span>
                                    <span class="image-size">{{ image.formatted_size }}</span>
                                    <span class="image-date">{{ formatDate(image.uploaded_at) }}</span>
                                </div>
                            </div>
                            }
                        </div>
                    </div>

                    <!-- Empty State for Images -->
                    <div class="empty-images-state"
                        *ngIf="uploadedImages.length === 0 && savedImages.length === 0 && !isLoadingImages">
                        <div class="empty-content">
                            <div class="empty-icon">
                                <i class="fas fa-image"></i>
                            </div>
                            <h3>No Images Uploaded</h3>
                            <p>Add images to enhance your block content</p>
                            <button class="empty-action-btn" (click)="triggerFileInput()">
                                <i class="fas fa-plus"></i>
                                Upload Your First Image
                            </button>
                        </div>
                    </div>
                </div>

               
           
         
    </section>

  
    <!-- Updated Image Modal with Navigation -->
    <div class="image-modal" *ngIf="selectedImageForView" (click)="closeImageModal()" (keydown)="onKeyDown($event)">
        <div class="modal-content" (click)="$event.stopPropagation()">
            <div class="modal-header">
                <h3>{{ selectedImageForView.name }}</h3>
                <div class="modal-navigation" *ngIf="allImages.length > 1">
                    <span class="image-counter">{{ getCurrentImagePosition() }}</span>
                    <div class="nav-buttons">

 

                        <button class="nav-btn prev" (click)="previousImage()" [disabled]="!hasPreviousImage()"
                            title="Previous image (←)">
                            <i class="fas fa-chevron-right"></i>
                        </button>

                        <button class="nav-btn next" (click)="nextImage()" [disabled]="!hasNextImage()"
                            title="Next image (→)">

                            <i class="fas fa-chevron-left"></i>
                        </button>


                    </div>
                </div>
                <button class="modal-close" (click)="closeImageModal()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <img [src]="getImageUrl(selectedImageForView)" [alt]="selectedImageForView.name">
                <div class="modal-info">
                    <div class="info-row">
                        <span class="label">File Name:</span>
                        <span class="value">{{ selectedImageForView.name }}</span>
                    </div>
                    <div class="info-row">
                        <span class="label">Size:</span>
                        <span class="value">{{ getImageSize(selectedImageForView) }}</span>
                    </div>
                    <div class="info-row" *ngIf="isSavedImage(selectedImageForView)">
                        <span class="label">Uploaded:</span>
                        <span class="value">{{ formatDate(selectedImageForView.uploaded_at) }}</span>
                    </div>
                    <div class="info-row" *ngIf="isSavedImage(selectedImageForView)">
                        <span class="label">Status:</span>
                        <span class="value saved-status">
                            <i class="fas fa-check-circle"></i>
                            Saved to Server
                        </span>
                    </div>
                    <div class="info-row" *ngIf="!isSavedImage(selectedImageForView)">
                        <span class="label">Status:</span>
                        <span class="value pending-status">
                            <i class="fas fa-clock"></i>
                            Pending Upload
                        </span>
                    </div>
                    <div class="info-row" *ngIf="isSavedImage(selectedImageForView) && selectedImageForView.metadata">
                        <span class="label">Dimensions:</span>
                        <span class="value"
                            *ngIf="selectedImageForView.metadata?.width && selectedImageForView.metadata?.height">
                            {{ selectedImageForView.metadata.width }} × {{ selectedImageForView.metadata.height }}px
                        </span>
                    </div>
                </div>

                <!-- Modal Actions -->
                <!-- <div class="modal-actions">
                    <button class="modal-btn secondary" (click)="closeImageModal()">
                        <i class="fas fa-times"></i>
                        Close
                    </button>
                    <button class="modal-btn danger" *ngIf="isSavedImage(selectedImageForView)"
                        (click)="removeSavedImage(selectedImageForView.id); closeImageModal()">
                        <i class="fas fa-trash"></i>
                        Delete Image
                    </button>
                    <button class="modal-btn danger" *ngIf="!isSavedImage(selectedImageForView)"
                        (click)="removeImage(selectedImageForView.id); closeImageModal()">
                        <i class="fas fa-trash"></i>
                        Remove from Upload
                    </button>
                </div> -->
            </div>
        </div>
    </div>
</div>
 