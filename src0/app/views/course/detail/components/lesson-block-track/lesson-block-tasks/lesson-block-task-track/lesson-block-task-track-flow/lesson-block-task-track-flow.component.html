<div class="status-flowchart">
    <h6 class="mb-3">
      <i class="fas fa-sitemap me-2"></i>
      Status Flow
    </h6>
    
    <!-- Loading State -->
    @if (isLoadingStatusFlow) {
      <div class="text-center py-4">
        <div class="spinner-border text-primary" role="status">
          <span class="visually-hidden">Loading...</span>
        </div>
        <p class="mt-2 text-muted">Loading status flow...</p>
      </div>
    }
    
    <!-- Error State -->
    @else if (statusFlowError) {
      <div class="alert alert-danger" role="alert">
        <i class="fas fa-exclamation-triangle me-2"></i>
        {{ statusFlowError }}
      </div>
    }
    
    <!-- Dynamic Status Flow -->
    @else {
      <div class="flowchart-container">
        <div class="status-flow">
          @for (status of statusFlow; track status.id; let i = $index) {
            <div class="status-item-wrapper">
              <div 
                class="status-node"
                [ngClass]="getStatusNodeClass(status)"
                (click)="selectStatus(status)">
                <div class="status-icon">
                  <i [class]="status.icon_class"></i>
                </div>
                <div class="status-label">{{ status.status_label }}</div>
                @if (isCurrentStatus(status)) {
                  <div class="current-indicator">
                    <i class="fas fa-location-arrow"></i>
                  </div>
                }
              </div>
              @if (shouldShowArrow(i)) {
                <div class="flow-arrow">
                  <i class="fas fa-chevron-right"></i>
                </div>
              }
            </div>
          }
        </div>
      </div>
    }
  </div>