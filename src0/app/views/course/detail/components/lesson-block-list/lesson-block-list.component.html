<div class="border-0 bg-transparent">
  <div class="p-0">
    <div class="table-responsive border-0">
      <table class="table table-dark-gray align-middle mb-0 table-hover" style="padding-bottom:200px;">
        <thead>
          <tr>
            <th scope="col" class="border-0 rounded-start">Block Information</th>
            <th scope="col" class="border-0">Difficulty & Rating</th>
            <th scope="col" class="border-0">Status</th>
            <th scope="col" class="border-0 rounded-end">Actions</th>
          </tr>
        </thead>

        <tbody>
          @if (lesson?.lessonBlocks && lesson?.lessonBlocks.length > 0) {
          @for (block of lesson.lessonBlocks; track block.id) {


          <tr [attr.data-block-id]="block.id" [ngClass]="{'bg-sketch-start': block.dev_status === 2, 'bg-sketch-end': block.dev_status === 3 
                             ,'bg-studio-start': block.dev_status === 4, 'bg-studio-end': block.dev_status === 5
                             , 'bg-finish': block.dev_status === 6}">
            <td>
              <div class="d-flex align-items-center">
                <div class="image-container position-relative">

                  <!-- <img [src]="block.coverImage || getDefaultCoverImage(block)" class="block-cover-image" alt="{{ block.title }}" 
                           onerror="this.src='/assets/images/courses/blocks/placeholder-video.jpg'"/>
                       -->

                  @if (block.cover_image) {
                  <img [src]="getImageUrl(block.cover_image)" alt="{{ block.title }}" class="block-cover-image"
                    (error)="handleImageError($event,block)">
                  }


                  <div class="status-badge image-overlay-badge" [ngClass]="block.status || 'draft'">
                    @if (block.status === 'published') {
                    <i class="fas fa-check-circle"></i>
                    } @else if (block.status === 'draft') {
                    <i class="fas fa-edit"></i>
                    } @else if (block.status === 'review') {
                    <i class="fas fa-sync-alt"></i>
                    } @else if (block.status === 'rejected') {
                    <i class="fas fa-times-circle"></i>
                    } @else {
                    <i class="fas fa-book"></i>
                    }
                    <span class="badge-text">{{ getStatusLabel(block) }}</span>
                  </div>
                </div>
                <div class="block-info me-3 ms-0">
                  <h6>
                    <a href="javascript:void(0);">{{ block.title }}</a>
                  </h6>

                  <div class="d-sm-flex">
                    <p class="h6 fw-light mb-0 small me-3">
                      <i class="fas fa-clock text-orange me-2"></i>
                      {{ block.duration || '0' }} minutes
                    </p>
                  </div>
                </div>
              </div>
            </td>

            <td>
  
              <div class="book-pages-compact">
                <!-- Student Page -->
                <div class="page-item mb-2">
                  <i class="fas fa-user-graduate text-primary"></i>
                  <span class="ms-1">
                    <small class="text-muted">Student:</small>
                    <strong>{{ block.student_book_page_no || 'N/A' }}</strong>
                  </span>
                </div>
                
                <!-- Teacher Page -->
                <div class="page-item">
                  <i class="fas fa-chalkboard-teacher text-success"></i>
                  <span class="ms-1">
                    <small class="text-muted">Teacher:</small>
                    <strong>{{ block.teacher_book_page_no || 'N/A' }}</strong>
                  </span>
                </div>
              </div>
             

            </td>

            <td>

              <div class="dev-status-badge mb-2 d-flex flex-column">
                <!-- <span class="badge bg-primary">{{ block.sketch_canva_link }}  </span> -->

                <button class="btn btn-sm btn-primary-soft btn-canva mb-2" title="Canva Design"
                  [disabled]="!block.sketch_canva_link || block.sketch_canva_link === ''"
                  (click)="navigateToCanva(block)">
                  <i class="fas fa-drafting-compass me-1"></i>
                  Canva
                </button>

                <button class="btn btn-sm btn-success-soft btn-drive mb-2" title="Google Drive"
                  [disabled]="!block.google_drive_link || block.google_drive_link === ''"
                  (click)="navigateToGoogleDrive(block)">
                  <i class="fab fa-google-drive me-1"></i>
                  Drive
                </button>
              </div>


            </td>

            <td>
              <div class="action-buttons-vertical">
                <button class="btn btn-sm btn-primary-soft btn-round mb-2" title="Storyboard"
                  (click)="navigateToStoryboard(block)">
                  <i class="fas fa-fw fa-film"></i>
                </button>
                <a href="javascript:void(0);" class="btn btn-sm btn-success-soft btn-round mb-2" title="Edit"
                  (click)="editBlock(block)">
                  <i class="far fa-fw fa-edit"></i>
                </a>
                <!-- Dropdown menu instead of direct navigation -->
                <div class="dropdown d-inline-block">
                  <button class="btn btn-sm btn-info-soft btn-round mb-2" type="button"
                    id="actionMenuButton-{{block.id}}"
                    (click)="$event.preventDefault(); $event.stopPropagation(); toggleActionMenu(block.id)">
                    <i class="far fa-fw fa-eye"></i>
                  </button>
                  <ul class="dropdown-menu dropdown-menu-end action-dropdown-menu shadow"
                    [ngClass]="{'show': activeActionMenuId === block.id}"
                    [attr.aria-labelledby]="'actionMenuButton-' + block.id">
                    <li>
                      <a class="dropdown-item" (click)="setDevBlockStatus(block, 'content')">
                        <i class="fas fa-file-alt me-2 text-primary"></i>Content
                      </a>
                    </li>
                    <li>
                      <a class="dropdown-item" (click)="setDevBlockStatus(block, 'storyboard')">
                        <i class="fas fa-film me-2 text-success"></i>Storyboard
                      </a>
                    </li>
                    <li>
                      <a class="dropdown-item" (click)="setDevBlockStatus(block, 'extra-req')">
                        <i class="fas fa-list-check me-2 text-info"></i>Extra Requirements
                      </a>
                    </li>
                    <li>
                      <a class="dropdown-item" (click)="setDevBlockStatus(block, 'sketch')">
                        <i class="fas fa-pencil-alt me-2 text-warning"></i>Sketch
                      </a>
                    </li>
                    <li>
                      <a class="dropdown-item" (click)="setDevBlockStatus(block, 'create-studio')">
                        <i class="fas fa-video me-2 text-danger"></i>Create Studio
                      </a>
                    </li>
                    <li>
                      <hr class="dropdown-divider">
                    </li>
                    <li>
                      <a class="dropdown-item" (click)="setDevBlockStatus(block, 'finish')">
                        <i class="fas fa-check-circle me-2 text-success"></i>Finish
                      </a>
                    </li>
                  </ul>
                </div>
                <!-- Delete button hidden as requested -->
              </div>
            </td>
          </tr>


          }
          } @else {
          <tr>
            <td colspan="4" class="text-center py-4">
              <div class="d-flex flex-column align-items-center">
                <i class="fas fa-info-circle fa-2x text-muted mb-2"></i>
                <p class="mb-0">No blocks found for this lesson</p>
                <button class="btn btn-sm btn-primary mt-3">Add New Block</button>
              </div>
            </td>
          </tr>
          }
        </tbody>
      </table>
    </div>
  </div>
</div>