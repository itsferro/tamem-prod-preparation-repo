<app-menu navClassName="container" menuClassName="mx-auto" [SearchWithText]="true" />

<main>
  <!-- Page Banner START -->
  <detail-banner [courseData]="courseData"></detail-banner>
  <!-- Page Banner END -->

  <!-- Page content START -->
  <section class="pb-0 py-sm-5">
    <div class="container">
      <!-- Loading state -->
      @if (isLoading) {
      <div class="row">
        <div class="col-12 text-center p-5">
          <div class="spinner-border text-primary" role="status">
            <span class="visually-hidden">جاري التحميل...</span>
          </div>
          <p class="mt-3">جاري تحميل المقرر...</p>
        </div>
      </div>
      }

      <!-- Error state -->
      @if (errorMessage) {
      <div class="row">
        <div class="col-12">
          <div class="alert alert-danger" role="alert">
            <i class="fas fa-exclamation-triangle me-2"></i>
            {{ errorMessage }}
          </div>
        </div>
      </div>
      }

      <!-- Content when loaded successfully -->
      @if (!isLoading && !errorMessage && courseData) {
      <div class="row g-3 align-items-center mb-4">
        <div class="col-md-8 ms-auto">
          <div class="row g-3 align-items-center justify-content-md-end me-auto">
            <div class="col-12 text-md-end">
              <div class="d-flex justify-content-between">
                <!-- Edit mode toggle button -->
                <button class="btn btn-outline-primary me-2" (click)="toggleSidebarEditMode()">
                  <i class="fas" [class.fa-edit]="!sidebarEditMode" [class.fa-eye]="sidebarEditMode"></i>
                  {{ sidebarEditMode ? 'وضع القراءة' : 'وضع التحرير' }}
                </button>

                <!-- Simple toggle button for mobile -->
                <button class="btn btn-primary mb-0 d-xl-none" type="button" style="width:auto;"
                  (click)="toggleSidebar()">
                  <i class="fas fa-book-open me-1"></i>
                  {{ showSidebar ? 'إخفاء الفهرس' : 'عرض الفهرس' }}
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Add buttons to toggle between views -->
      <!-- <div class="view-toggle-buttons">
        <button class="btn btn-primary" (click)="setViewMode('lesson')">View Lesson</button>
        <button class="btn btn-secondary" (click)="setViewMode('blocks')">View Manage Blocks</button>
      </div> -->

      <div class="row">
        <!-- Main content area -->
        <div class="col-xl-9 col-xxl-8" [class.col-12]="!showSidebar">
          <!-- Use [hidden] property instead of @if to prevent reloading -->
          <div [hidden]="viewMode !== 'lesson' || isJourneyActive">
            <detail-lesson-view [lesson]="selectedLesson" [isEditMode]="sidebarEditMode"
              (startJourney)="onStartJourney($event)">
            </detail-lesson-view>
          </div>
          <!-- <div [hidden]="viewMode !== 'blocks' || isJourneyActive">
            <detail-manage-blocks [lesson]="selectedLesson"></detail-manage-blocks>
          </div> -->
          <div [hidden]="!isJourneyActive">
            <detail-learning-journey [lesson]="selectedLesson" [currentBlock]="selectedBlock"
              (returnToLesson)="onReturnToLesson()">
            </detail-learning-journey>
          </div>
        </div>

        <!-- Sidebar area with simple show/hide logic -->
        @if (showSidebar) {
        <div class="col-xl-3 col-xxl-4">
          <div class="right-sidebar-panel">
            <!-- Close button for mobile view -->
            <button class="btn btn-sm btn-outline-secondary float-end d-xl-none mb-2" (click)="toggleSidebar()">
              <i class="fas fa-times"></i>
            </button>

            <!-- Pass data to right sidebar and listen for lesson selection -->
            <detail-right-sidebar [courseData]="courseData" [editMode]="sidebarEditMode"
              (lessonSelected)="onLessonSelected($event)">
            </detail-right-sidebar>
          </div>
        </div>
        }
      </div>
      }
    </div>
  </section>
</main>

<app-footer className="bg-light" />