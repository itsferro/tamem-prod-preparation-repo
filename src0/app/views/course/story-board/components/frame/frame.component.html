<div class="storyboard-frame scene-colored" [style.--scene-color]="frameData.sceneColor" style="position: relative;">
   
 
    <div class="frame-prompt-top-bar">

           <!-- here the floating image prompots icons  -->
           <div class="image-prompts-container"  >
            <!-- Handle single prompt (legacy support) -->
            @if (isStringPrompt(frameData.imagePrompt)) {
            <div class="image-prompt-icon" (click)="handleImagePromptCopy($event, frameData.imagePrompt)"
              title="نسخ وصف الصورة">
              <i class="fas fa-image"></i>
              <span class="copy-tooltip">نسخ</span>
            </div>
            }
        
            <!-- Handle array of prompts -->
            @else {
            @for (prompt of getPromptArray(frameData.imagePrompt); track $index) {
            <div class="image-prompt-icon" (click)="handleImagePromptCopy($event, prompt)"
              title="نسخ وصف الصورة {{$index + 1}}">
              <i class="fas fa-image"></i>
              <span class="prompt-number">{{$index + 1}}</span>
              <span class="copy-tooltip">نسخ</span>
            </div>
            }
            }
          </div>

          
    </div>

 
 
  
  <!-- Top image area -->
  <div class="frame-image-container">


    <!-- here the floating duration icons  -->
    <div class="duration-container"  >
        مدة اللقطة: {{frameData.duration || 0}} ثانية
     
    </div>


    @if (frameData.imageUrl) {
    <img [src]="getImageUrl(frameData.imageUrl)" [alt]="frameData.title || 'صورة اللقطة'" class="frame-image"
      (error)="handleImageError($event)" (click)="openImagePreview($event)">
    } @else {
    <div class="empty-image" (click)="onSelectImage($event)">
      <i class="fas fa-image"></i>
    </div>
    }
  </div>


   





  <!-- Controls section directly below image -->
  <div class="frame-controls">
    <button class="control-btn" (click)="onMoveFrame(-1)" title="Move backward">
      <i class="fas fa-chevron-right"></i>
    </button>
    <button class="control-btn" (click)="onDeleteFrame()" title="Delete frame">
      <i class="fas fa-trash"></i>
    </button>
    <button class="control-btn" (click)="onSelectImage($event)" title="Upload image">
      <i class="fas fa-upload"></i>
    </button>
    <button class="control-btn" (click)="openImagePromptModal()" title="Generate image prompt">
      <i class="fas fa-camera"></i>
    </button>
    <button class="control-btn" (click)="onMoveFrame(1)" title="Move forward">
      <i class="fas fa-chevron-left"></i>
    </button>
  </div>

  <!-- Frame details section -->
  <div class="frame-details">
    <!-- Frame number and label - now using the same pattern as other fields -->
    <div class="content-field">
      <div class="field-icon">
        <div class="frame-number">{{ frameNumber }}</div>
      </div>
      <input type="text" [(ngModel)]="frameData.title" placeholder="Label" (blur)="onContentChanged('title')">
    </div>

    <!-- Visual Content section -->
    <div class="content-field">
      <div class="field-icon">
        <i class="fas fa-image"></i>
      </div>
      <textarea [(ngModel)]="frameData.visualContentNotes" placeholder="Visual Content"
        (blur)="onContentChanged('visualContentNotes')" (input)="autoGrow($event)"
        class="visualContentNotes-expand-field"></textarea>
    </div>

    <!-- Voiceover Text section -->
    <div class="content-field">
      <div class="field-icon">
        <i class="fas fa-microphone"></i>
      </div>
      <textarea style = 'background-color: antiquewhite;' [(ngModel)]="frameData.voiceoverText" placeholder="Voiceover" (blur)="onContentChanged('voiceoverText')"
        (input)="autoGrow($event)" class="voiceoverText-expand-field"></textarea>
    </div>

    <!-- On-Screen Text section -->
    <div class="content-field">
      <div class="field-icon">
        <i class="fas fa-align-left"></i>
      </div>
      <textarea [(ngModel)]="frameData.onScreenText" placeholder="On-Screen Text"
        (blur)="onContentChanged('onScreenText')" (input)="autoGrow($event)"
        class="onScreenText-expand-field"></textarea>
    </div>

    <!-- Notes section -->
    <div class="content-field">
      <div class="field-icon">
        <i class="fas fa-sticky-note"></i>
      </div>
      <textarea [(ngModel)]="frameData.notes" placeholder="Notes" (blur)="onContentChanged('notes')"
        (input)="autoGrow($event)" class="notes-expand-field"></textarea>
    </div>

 
        <!-- EtraReq section -->
        <div class="content-field" style="height:55px;">
          <div class="field-icon">
            <i class="fas fa-magic"></i>
          </div>
          <textarea [(ngModel)]="frameData.extraReq" placeholder="Extra Req" (blur)="onContentChanged('extraReq')"
          (input)="autoGrow($event)" class="extra-expand-field"></textarea>
        </div>



    <!-- Resources section -->
    <!-- <div class="content-field">
      <div class="field-icon">
        <i class="fas fa-link"></i>
      </div>
      <input type="text" [(ngModel)]="newResourceUrl" 
             placeholder="Resources"
             (keyup.enter)="addResource()">
    </div> -->


  </div>
</div>



<!-- Image Preview Modal -->
@if (previewImageUrl) {
<div class="image-preview-overlay" (click)="closeImagePreview()">
  <div class="image-preview-container">
    <div class="preview-controls">
      <button class="close-preview" (click)="closeImagePreview()">
        <i class="fas fa-times"></i>
      </button>
    </div>
    <img [src]="previewImageUrl" [alt]="frameData.title || 'صورة مكبرة'" class="preview-image">
  </div>
</div>
}