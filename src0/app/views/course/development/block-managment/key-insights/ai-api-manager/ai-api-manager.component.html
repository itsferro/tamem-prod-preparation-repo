<div class="ai-api-manager">
  <!-- Header -->
  <div class="header">
    <h2>AI API Testing Lab</h2>
    <p>Test and experiment with AI API requests</p>
    
    <!-- Mode Toggle -->
    <div class="mode-toggle">
      <button 
        (click)="toggleMode()" 
        class="btn" 
        [class.btn-primary]="simpleMode"
        [class.btn-secondary]="!simpleMode">
        {{ simpleMode ? 'üìù Simple Mode' : 'üîß Advanced Mode' }}
      </button>
      <span class="mode-description">
        {{ simpleMode ? 'Easy text input/output' : 'Full JSON control' }}
      </span>
    </div>
  </div>

  <!-- Simple Mode Interface -->
  <div class="simple-interface" *ngIf="simpleMode">
    <div class="simple-grid">
      <!-- Simple Input Panel -->
      <div class="simple-panel">
        <div class="panel-header">
          <h3>‚úçÔ∏è Your Message</h3>
          <div class="header-actions">
            <button (click)="clearSimpleInputs()" class="btn btn-secondary btn-sm">Clear</button>
          </div>
        </div>
        
        <div class="simple-container">
          <textarea 
            [(ngModel)]="simpleInput"
            class="simple-textarea"
            placeholder="Type your message here... e.g., 'Write a poem about the ocean' or 'Explain quantum physics simply'"
            rows="6">
          </textarea>
          
          <!-- Simple Controls -->
          <div class="simple-controls">
            <div class="control-group">
              <label>Model:</label>
              <select [(ngModel)]="selectedModel" class="control-select">
                <optgroup *ngFor="let provider of providerKeys" 
                          [label]="provider">
                  <option *ngFor="let model of groupedModels[provider]" 
                          [value]="model.value">
                    {{ model.label }}
                  </option>
                </optgroup>
              </select>
            </div>
            
            <div class="control-group">
              <label>Creativity: {{ temperature }}</label>
              <input type="range" [(ngModel)]="temperature" min="0" max="1" step="0.1" class="control-range">
              <small>{{ temperature < 0.3 ? 'Focused' : temperature < 0.7 ? 'Balanced' : 'Creative' }}</small>
            </div>
            
            <div class="control-group">
              <label>Max Length:</label>
              <select [(ngModel)]="maxTokens" class="control-select">
                <option value="50">Short (50)</option>
                <option value="200">Medium (200)</option>
                <option value="500">Long (500)</option>
                <option value="1000">Very Long (1000)</option>
              </select>
            </div>
          </div>
        </div>
      </div>
      
      <!-- Simple Output Panel -->
      <div class="simple-panel">
        <div class="panel-header">
          <h3>ü§ñ AI Response</h3>
          <div class="header-actions">
            <button (click)="copySimpleOutput()" class="btn btn-secondary btn-sm" *ngIf="simpleOutput">
              Copy Response
            </button>
          </div>
        </div>
        
        <div class="simple-container">
          <div class="simple-output" *ngIf="!isLoading && !simpleOutput" class="empty-state">
            <p>üí≠ Send a message to see the AI response here</p>
          </div>
          
          <div *ngIf="isLoading" class="loading-state">
            <div class="loading-spinner large"></div>
            <p>ü§î AI is thinking...</p>
          </div>
          
          <div *ngIf="simpleOutput" class="simple-response">
            <div class="response-text">{{ simpleOutput }}</div>
          </div>
          
          <div *ngIf="response && !response.success" class="simple-error">
            <p>‚ùå {{ response.error }}</p>
          </div>
        </div>
      </div>
    </div>
    
    <!-- Simple Send Button -->
    <div class="simple-actions">
      <button 
        (click)="sendToAiApi()" 
        [disabled]="isLoading || !simpleInput.trim()"
        class="btn btn-primary btn-large">
        <span *ngIf="isLoading" class="loading-spinner"></span>
        {{ isLoading ? 'Sending...' : 'üöÄ Send Message' }}
      </button>
    </div>
  </div>

  <!-- Advanced Mode Interface -->
  <div class="advanced-interface" *ngIf="!simpleMode">
    <div class="content-grid">
      
      <!-- Left Panel: Code Editor -->
      <div class="editor-panel">
        <div class="panel-header">
          <h3>API Request Code</h3>
          <div class="header-actions">
            <select (change)="loadSample($event)" class="sample-select">
              <option value="">Load Template...</option>
              <optgroup label="Standard Templates">
                <option value="openai_chat">OpenAI Chat</option>
                <option value="openai_completion">OpenAI Completion</option>
                <option value="claude">Claude</option>
                <option value="gemini">Gemini</option>
                <option value="custom_function_calling">Function Calling</option>
                <option value="image_generation">DALL-E Images</option>
              </optgroup>
            </select>
            <button (click)="saveAsTemplate()" class="btn btn-secondary btn-sm">Save Template</button>
            <button (click)="clearCode()" class="btn btn-secondary btn-sm">Clear</button>
          </div>
        </div>
        
        <div class="editor-container">
          <textarea 
            [(ngModel)]="apiCode"
            class="code-editor"
            placeholder="Enter your AI API request JSON here..."
            spellcheck="false">
          </textarea>
        </div>
        
        <div class="editor-actions">
          <button 
            (click)="sendToAiApi()" 
            [disabled]="isLoading || !apiCode.trim()"
            class="btn btn-primary">
            <span *ngIf="isLoading" class="loading-spinner"></span>
            {{ isLoading ? 'Sending...' : 'Send to AI API' }}
          </button>
          <button (click)="copyToClipboard(apiCode)" class="btn btn-secondary">
            Copy Code
          </button>
        </div>
      </div>

      <!-- Right Panel: Response Viewer -->
      <div class="response-panel">
        <div class="panel-header">
          <h3>API Response</h3>
          <div class="header-actions">
            <button (click)="clearResponse()" class="btn btn-secondary btn-sm">Clear</button>
          </div>
        </div>
        
        <div class="response-container">
          <div *ngIf="!response && !isLoading" class="empty-state">
            <p>No response yet. Send a request to see the results here.</p>
          </div>
          
          <div *ngIf="isLoading" class="loading-state">
            <div class="loading-spinner large"></div>
            <p>Sending request to AI API...</p>
          </div>
          
          <div *ngIf="response" class="response-content">
            <!-- Success Response -->
            <div *ngIf="response.success" class="response-success">
              <div class="response-header">
                <span class="status-badge success">‚úì Success</span>
                <span class="timestamp">{{ response.timestamp | date:'medium' }}</span>
              </div>
              <div class="response-data">
                <pre class="json-display">{{ formatJson(response.data) }}</pre>
              </div>
              <button (click)="copyToClipboard(formatJson(response.data))" class="btn btn-secondary btn-sm">
                Copy Response
              </button>
            </div>
            
            <!-- Error Response -->
            <div *ngIf="!response.success" class="response-error">
              <div class="response-header">
                <span class="status-badge error">‚úó Error</span>
                <span class="timestamp">{{ response.timestamp | date:'medium' }}</span>
              </div>
              <div class="error-message">
                <p>{{ response.error }}</p>
              </div>
            </div>
          </div>
        </div>
      </div>
      
    </div>
  </div>

  <!-- Custom Templates Panel -->
  <div class="templates-panel" *ngIf="customTemplates.length > 0">
    <div class="panel-header">
      <h3>Custom Templates</h3>
      <div class="header-actions">
        <input type="file" #fileInput (change)="importTemplates($event)" accept=".json" style="display: none;">
        <button (click)="fileInput.click()" class="btn btn-secondary btn-sm">Import</button>
        <button (click)="exportTemplates()" class="btn btn-secondary btn-sm">Export</button>
      </div>
    </div>
    
    <div class="templates-grid">
      <div *ngFor="let template of customTemplates" class="template-card">
        <div class="template-header">
          <h4>{{ template.name }}</h4>
          <div class="template-actions">
            <button (click)="loadCustomTemplate(template)" class="btn btn-link btn-sm">Load</button>
            <button (click)="deleteCustomTemplate(template.id)" class="btn btn-link btn-sm delete">Delete</button>
          </div>
        </div>
        <p class="template-description" *ngIf="template.description">{{ template.description }}</p>
        <div class="template-meta">
          <span class="template-date">Created: {{ template.created | date:'short' }}</span>
        </div>
        <div class="template-preview">
          <code>{{ template.request.slice(0, 100) }}{{ template.request.length > 100 ? '...' : '' }}</code>
        </div>
      </div>
    </div>
  </div>

  <!-- History Panel -->
  <div class="history-panel" *ngIf="requestHistory.length > 0">
    <div class="panel-header">
      <h3>Request History</h3>
      <button (click)="clearHistory()" class="btn btn-secondary btn-sm">Clear History</button>
    </div>
    
    <div class="history-list">
      <div 
        *ngFor="let item of requestHistory; let i = index" 
        class="history-item"
        [class.success]="item.response.success"
        [class.error]="!item.response.success">
        
        <div class="history-header">
          <span class="history-index">#{{ requestHistory.length - i }}</span>
          <span class="history-status" 
                [class.success]="item.response.success"
                [class.error]="!item.response.success">
            {{ item.response.success ? 'Success' : 'Error' }}
          </span>
          <span class="history-time">{{ item.timestamp | date:'short' }}</span>
          <button (click)="loadFromHistory(item)" class="btn btn-link btn-sm">Load</button>
        </div>
        
        <div class="history-preview">
          <div class="request-preview">
            <strong>Request:</strong>
            <code>{{ item.request.slice(0, 100) }}{{ item.request.length > 100 ? '...' : '' }}</code>
          </div>
          
          <div class="response-preview" *ngIf="item.response.success">
            <strong>Response:</strong>
            <code>{{ formatJson(item.response.data).slice(0, 100) }}...</code>
          </div>
          
          <div class="error-preview" *ngIf="!item.response.success">
            <strong>Error:</strong>
            <code class="error-text">{{ item.response.error }}</code>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>



<block-managment-ai-api-images/>